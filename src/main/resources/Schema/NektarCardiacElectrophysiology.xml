<?xml version="1.0" encoding="UTF-8"?>
<!-- Types available from the tempss schema: 
     positiveDouble, xs:double, xs:string, xs:positiveInteger, file -->
<CardiacElectrophysiology xmlns="http://www.libhpc.imperial.ac.uk"
                          xmlns:libhpc="http://www.libhpc.imperial.ac.uk/SchemaAnnotation"
                          xmlns:tempss="http://www.libhpc.imperial.ac.uk/tempss/SchemaAnnotation">
  <libhpc:documentation>
    The Nektar++ finite element PDE solver for cardiac electrophysiology.
    Nektar++ user guide: http://www.nektar.info/docs/manual/user-guide-4.0.0.pdf
  </libhpc:documentation>
  <Physics>
    <libhpc:documentation>
      This section contains the parameters that define the physics of the 
      problem or, equivalently, the PDE coefficients.
    </libhpc:documentation>
    <Model paramType="choice">
      <Monodomain>
        <libhpc:documentation>
          The monodomain model is a reduction of the bidomain model of the 
          electrical propagation in myocardial tissue. The reduction comes 
          from assuming that the intra- and extracellular domains have equal 
          anisotropy ratios. Although not as physiologically accurate as the 
          bidomain model, it is still adequate in some cases, and has reduced 
          complexity. http://en.wikipedia.org/wiki/Monodomain_model
        </libhpc:documentation>
        <Chi type="positiveDouble" inputType="text" units="mm&lt;sup&gt;-1&lt;/sup&gt;">
          <libhpc:documentation>Membrane surface to volume ratio</libhpc:documentation>
        </Chi>
        <Cm  type="positiveDouble" inputType="text">
          <libhpc:documentation>Membrane capacitance per unit area</libhpc:documentation>
        </Cm>
        <IsotropicConductivity paramType="choice">
          <libhpc:documentation>
            The isotropicConductivity specifies the conductivity of the tissue, 
            assuming it is the same in the x-, y- and z-coordinate directions. 
            Nektar++ also allows anisotropic conductivity to be specified, to 
            allow for fibres in the heart which conduct better along their 
            length than across their breadth. (Anisotropic conductivity not 
            currently supported by the libhpc/nekkloud tree).
            
            Choose between providing the conductivity directly, or by 
            providing the intensity from an MRI scan, from which the 
            conductivity will be approximated internally.
          </libhpc:documentation>
          <Conductivity type="xs:double" inputType="text" units="mS mm&lt;sup&gt;-1&lt;/sup&gt;">
            <libhpc:documentation>The constant conductvity.</libhpc:documentation>
          </Conductivity>
          <Intensity>
            <Intensity type="xs:double" inputType="text"></Intensity>
            <DMin name="d_min" type="xs:double" inputType="text"></DMin>
            <DMax name="d_max" type="xs:double" inputType="text"></DMax>
          </Intensity>
          <NotProvided/>
        </IsotropicConductivity>
      </Monodomain>
      <Bidomain>
        <libhpc:documentation>
          Model of the electrical properties of cardiac muscle that takes 
          into account the anisotropy of both the intracellular and 
          extracellular spaces. http://en.wikipedia.org/wiki/Bidomain_model 
        </libhpc:documentation>
        <Sigmai type="positiveDouble"></Sigmai>
        <Sigmaix type="positiveDouble"></Sigmaix>
        <Sigmaiy type="positiveDouble"></Sigmaiy>
        <Sigmaiz type="positiveDouble"></Sigmaiz>
      </Bidomain>
    </Model>
    <CellModel>
      <libhpc:documentation>
        The action potential of a cardiac cell can be modelled at either a 
        biophysical level of detail, including a number of transmembrane 
        currents, or as a phenomenological model, to reproduce the features 
        of the action potential, with fewer variables. Each cell model will 
        include a unique system of ODEs to represent the gating variables of 
        that model.
      </libhpc:documentation>
      <CellModelType paramType="choice">
        <CourtemancheRamirezNattel98>
          <CellModelVariant type="xs:string" inputType="choice">
            <tempss:item>Original</tempss:item>
            <tempss:item>AF</tempss:item>
          </CellModelVariant>
        </CourtemancheRamirezNattel98>
        <FitzhughNagumo>
        </FitzhughNagumo>
        <TenTusscher>
          <CellModelVariant type="xs:string" inputType="choice">
            <tempss:item>Endocardium</tempss:item>
            <tempss:item>Epicardium</tempss:item>
            <tempss:item>Mid</tempss:item>
          </CellModelVariant>
        </TenTusscher>
        <AlievPanfilov>
          <A type="xs:double" inputType="text"></A>
          <Eps type="positiveDouble" inputType="text"></Eps>
          <K type="positiveDouble" inputType="text"></K>
          <Mu1 type="positiveDouble" inputType="text"></Mu1>
          <Mu2 type="positiveDouble" inputType="text"></Mu2>
        </AlievPanfilov>
        <FentonKarma>
          <CellModelVariant type="xs:string" inputType="choice">
            <tempss:item>BR</tempss:item>
            <tempss:item>MBR</tempss:item>
            <tempss:item>MLR1</tempss:item>
            <tempss:item>GP</tempss:item>
            <tempss:item>CF1</tempss:item>
            <tempss:item>CF2a</tempss:item>
            <tempss:item>CF2b</tempss:item>
            <tempss:item>CF2c</tempss:item>
            <tempss:item>CF3a</tempss:item>
            <tempss:item>CF3b</tempss:item>
          </CellModelVariant>
        </FentonKarma>
      </CellModelType>
      <SubSteps type="xs:positiveInteger"/>
    </CellModel>
  </Physics>
  <ProblemSpecification>
    <libhpc:documentation>
      Specification of the particular problem to solve, including geometry 
      initial and boundary conditions, etc.
    </libhpc:documentation>
    <GeometryAndBoundaryConditions>
      <Geometry inputType="file"/>
      <BoundaryCondition minOccurs="1" maxOccurs="unbounded">
        <Variable inputType="text"/>
        <Comment inputType="text"/>
        <Variable inputType="text"/>
        <Type inputType="choice">
          <tempss:item>NotProvided</tempss:item>
          <tempss:item>D</tempss:item>
          <tempss:item>N</tempss:item>
        </Type>
        <Value inputType="text"/>
        <UserDefinedType inputType="choice">
          <tempss:item>NotProvided</tempss:item>
          <tempss:item>TimeDependent</tempss:item>
        </UserDefinedType>
      </BoundaryCondition>
    </GeometryAndBoundaryConditions>
    <InitialConditions paramType="choice">
      <Function inputType="text"/>
      <File inputType="file"/>
    </InitialConditions>
    <Stimuli>
      <Stimulus>
        <StimulusType paramType="choice">
          <StimulusPoint>
            <PStrength name="p_strength" inputType="text" units="uA"/>
          </StimulusPoint>
          <StimulusCircle>
            <PStrength name="p_strength" inputType="text" units="uA mm-3"/>
            <Px1 name="p_x1" inputType="text" units="mm"/>
            <Py1 name="p_y1" inputType="text" units="mm"/>
            <Pz1 name="p_z1" inputType="text" units="mm"/>
            <Pr1 name="p_x2" inputType="text" units="mm"/>
            <PIs name="p_is" inputType="text"/>
          </StimulusCircle>
          <StimulusRectangle>
            <PStrength name="p_strength" inputType="text"/>
            <Px1 name="p_x1" inputType="text" units="mm"/>
            <Py1 name="p_y1" inputType="text" units="mm"/>
            <Pz1 name="p_z1" inputType="text" units="mm"/>
            <Px2 name="p_x2" inputType="text" units="mm"/>
            <Py2 name="p_y2" inputType="text" units="mm"/>
            <Pz2 name="p_z2" inputType="text" units="mm"/>
            <PIs name="p_is" inputType="text"/>
          </StimulusRectangle>
        </StimulusType>
        <Protocol>
          <ProtocolS1S2>
            <Start inputType="text" units="ms"/>
            <Duration inputType="text" units="ms"/>
            <S1CycleLength inputType="text" units="ms"/>
            <Num_S1 inputType="text"/>
            <S2CycleLength inputType="text" units="ms"/>
          </ProtocolS1S2>
          <ProtocolS1>
            <Start inputType="text" units="ms"/>
            <Duration inputType="text" units="ms"/>
            <S1CycleLength inputType="text" units="ms"/>
            <Num_S1 inputType="text"/>
          </ProtocolS1>
          <ProtocolSingle>
            <Start inputType="text" units="ms"/>
            <Duration inputType="text" units="ms"/>
          </ProtocolSingle>
        </Protocol>
      </Stimulus>
    </Stimuli>
    <Expansion>
      <PolynomialOrder inputType="text"/>
      <BasisType inputType="choice">
        <tempss:item>MODIFIED</tempss:item>
        <tempss:item>GAUSS_LAGRANGE</tempss:item>
        <tempss:item>GLL_LAGRANGE</tempss:item>
        <tempss:item>GLL_LAGRANGE_SEM</tempss:item>
        <tempss:item>CHEBYSHEV</tempss:item>
      </BasisType>
    </Expansion>
    <FinalTime inputType="text"/>
    <TimeStep inputType="text"/>
  </ProblemSpecification>
  <NumericalAlgorithm>
    <Projection inputType="choice">
      <tempss:item>ContinuousGalerkin</tempss:item>
      <tempss:item>DiscontinuousGalerkin</tempss:item>
    </Projection>
    <TimeIntegration>
      <TimeIntegrationMethod inputType="choice">
        <tempss:item>IMEXOrder1</tempss:item>
        <tempss:item>IMEXOrder2</tempss:item>
        <tempss:item>IMEXOrder3</tempss:item>
        <tempss:item>DIRKOrder1</tempss:item>
        <tempss:item>ForwardEuler</tempss:item>
        <tempss:item>BackwardEuler</tempss:item>
        <tempss:item>ClassicalRungeKutta4</tempss:item>
      </TimeIntegrationMethod>
      <DiffusionAdvancement inputType="choice">
        <tempss:item>Implicit</tempss:item>
        <tempss:item>Explicit</tempss:item>
      </DiffusionAdvancement>
    </TimeIntegration>
    <MatrixInversion paramType="choice">
      <Direct>
        <SubStructuring inputType="choice">
          <tempss:item>Full</tempss:item>
          <tempss:item>StaticCondensation</tempss:item>
        </SubStructuring>
      </Direct>
      <Iterative>
        <SubStructuring inputType="choice">
          <tempss:item>Full</tempss:item>
          <tempss:item>StaticCondensation</tempss:item>
        </SubStructuring>
        <Preconditioner inputType="choice">
          <tempss:item>LowEnergy</tempss:item>
          <tempss:item>Diagonal</tempss:item>
          <tempss:item>BlockDiagonal</tempss:item>
          <tempss:item>LowEnergyWithLinearSpace</tempss:item>
        </Preconditioner>
        <SuccessiveRHS inputType="text"/>
        <IterativeSolverTolerance inputType="text"/>
      </Iterative>
    </MatrixInversion>
    <GlobalOptimizationParameters>
      <BackwardTransform paramType="choice">
        <GlobalMatrixEvaluation />
        <ElementalEvaluation>
          <Triangles inputType="choice">
            <tempss:item>SumFactorization</tempss:item>
            <tempss:item>LocalMatrix</tempss:item>
          </Triangles>
          <Quadrilaterals inputType="choice">
            <tempss:item>SumFactorization</tempss:item>
            <tempss:item>LocalMatrix</tempss:item>
          </Quadrilaterals>
        </ElementalEvaluation>
      </BackwardTransform>
      <InnerProductWRTBase paramType="choice">
        <GlobalMatrixEvaluation />
        <ElementalEvaluation>
          <Triangles inputType="choice">
            <tempss:item>SumFactorization</tempss:item>
            <tempss:item>LocalMatrix</tempss:item>
          </Triangles>
          <Quadrilaterals inputType="choice">
            <tempss:item>SumFactorization</tempss:item>
            <tempss:item>LocalMatrix</tempss:item>
          </Quadrilaterals>
        </ElementalEvaluation>
      </InnerProductWRTBase>
      <MassMatrixOp paramType="choice">
        <GlobalMatrixEvaluation />
        <ElementalEvaluation>
          <Triangles inputType="choice">
            <tempss:item>SumFactorization</tempss:item>
            <tempss:item>LocalMatrix</tempss:item>
          </Triangles>
          <Quadrilaterals inputType="choice">
            <tempss:item>SumFactorization</tempss:item>
            <tempss:item>LocalMatrix</tempss:item>
          </Quadrilaterals>
        </ElementalEvaluation>
      </MassMatrixOp>
      <HelmholtzMatrixOp paramType="choice">
        <GlobalMatrixEvaluation />
        <ElementalEvaluation>
          <Triangles inputType="choice">
            <tempss:item>SumFactorization</tempss:item>
            <tempss:item>LocalMatrix</tempss:item>
          </Triangles>
          <Quadrilaterals inputType="choice">
            <tempss:item>SumFactorization</tempss:item>
            <tempss:item>LocalMatrix</tempss:item>
          </Quadrilaterals>
        </ElementalEvaluation>
      </HelmholtzMatrixOp>
    </GlobalOptimizationParameters>
  </NumericalAlgorithm>
  <Admin>
    <IO_CheckSteps inputType="text"/>
    <IO_InfoSteps inputType="text"/>
  </Admin>
</CardiacElectrophysiology>
